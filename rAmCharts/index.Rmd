---
title: "rAmCharts package"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: yes
---
  
The package rAmCharts allows you to draw JavaScript charts wich are by nature interactive.
Its architecture is based on S4 classes and corresponds almost exactly to the
original library [AmCharts][url_amcharts].

For readability matters, we do not detail much **htmlwidgets** features on the present website. For more details consult directly <http://www.htmlwidgets.org>.

# Getting started

## pipeR

When loading the packge, you note that it is fully compatible with other plot methods since it uses S4 signature for each functionnality.
```{r,echo=FALSE}
library(rAmCharts)
```

In the rest of this short introduction, you will either see the symbol `%>>%` or calls to function `pipeline` from the package [*pipeR*][home_pipeR].  For more details, please refer to the official tutorial.

For the present quick introduction on rAmCharts, we just have to keep in mind that using this syntax, the left hand code is evaluated and passed as the first argument of the function which follow `%>>%` (or alternatively it can can be any argument by indicating a `.` using `()` or `{}` ).

For example:
```{r}
data(iris)
summary(iris, digits = 2)
```
is equivalent to:
```{r}
library(pipeR)
data(iris)
iris %>>% summary( digits = 2 )
# or:
# pipeline(iris, summary(digits = 2))
# pipeline(iris, (summary(digits = 2, object = .))) 
```

---

## Quick tour:

### Example

Start with a simple pie chart

```{r, echo=FALSE, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country',
             dataProvider = data_gdp, startDuration = 0),
  plot()
)
```

```{r, echo=FALSE, eval=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country',
             dataProvider = data_gdp, startDuration = 0),
  plot()
)
```

### Details...

If you look at the JavaScript source code you will find something like:

```javascript
{
type: "pie",
theme: "light",
valueField: "gdp",
titleField: "country",
dataProvider: [
{ country: "China", gdp: 18.976 },
{ country: "United States", gdp: 18.125 },
...
],
}
```

Although the syntax appears very different, it has similarities. If you observe the result before calling the `plot` method, you see a global list containing each parameter mentionned in the code:

```{r, message = FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country',
             dataProvider = data_gdp[1:2,]),
  print()
)
```

This list can be easily mapped to the previous JavaScript code with the following tips:

* A JavaScript object corresponds to a __R__ list;
* A JavaScript array (a wrapper for an object) also corresponds to a __R__ list.

This structure and mapping are fundamental to the how we construct charts with the package.

The key is to imagine the function call as a list containing every properties for an S4 class initializer:

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country',
             dataProvider = data_gdp),
  class()
)
```

* Each element from the function call is a first level property.
* Other complex first level properties have their own dedicated functions for which the first argument is always the inherited S4 class object.

To illustrate, `setDataProvider` is a valid method for setting chart data of classes AmChart and DatSet:

```{r}
showMethods("setDataProvider")
```

Therefore, it can be used in those contexts:

```{r, eval = FALSE}
# Add dataProvider to an object of class AmChart:
pipeR::pipeline(
  amSerialChart([first level properties]),
  setDataProvider(dataProvider = ...)
)

pipeR::pipeline(
  amPieChart([first level properties]),
  setDataProvider(dataProvider = ...)
)

# ...

# Add dataProvider to a dataSet:
pipeR::pipeline(
  dataSet([first level properties]),
  setDataProvider(dataProvider = ...)
)
```

## Serial Chart

The type of the chart is determined with the call constructor. The argument to pass will depend on the chart type. For instance, the previous chart can be convert in a serial one. By default it will result in a line chart:

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0, categoryField = 'country'),
  addGraph(valueField = 'gdp'),
  plot(height = "250")
)
```

However, you can easily obtain columns with the argument `type`:

```{r, message=FALSE, highlight=TRUE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0, categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column'),
  plot()
)
```

Moreover, you can custom the column:

* `fillAlphas` is used to adjust the opacity in the columns;
* `lineAlpha` is used to adjust the opacity of the border.

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0, categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5),
  plot()
)

library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0, categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5, lineAlpha = 0),
  plot()
)
```

This example is the occasion to introduce the chart setters. We have just added a graph to a serial chart with a call to `addGraph`. Typically this kind of function can either take into account a argument of a specific class or just its properties. Whereas the first case is usefull to generate many charts (factor the code), the second one will be more common. Hence the above example is equivalent to:

```{r, eval=FALSE}
library(rAmCharts)
data("data_gdp")
graph <- graph(valueField = 'gdp', type = 'column', fillAlphas = .5, lineAlpha = 0)
# graph an amGraph are constructors for the same class 
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0, categoryField = 'country'),
  addGraph(amGraph = graph),
  plot()
)
```

The package is structured to *fit the architecture* of AmCharts.

Thus the function "api" can be used to find out the right arguments. In this case we could run `api("AmSerialChart")` to learn that a chart posseses a property named "graphs". In the API it said it is an array of "AmGraph" which corresponds to a list in the package. Consequently, we can use the dedicated setter:

```{r, eval=FALSE}
library(rAmCharts)
data("data_gdp")
graph <- graph(valueField = 'gdp', type = 'column', fillAlphas = .5, lineAlpha = 0)
graphs <- list(graph)

pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0, categoryField = 'country'),
  setGraphs(graphs = graphs),
  plot()
)

# or...
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0,
                categoryField = 'country', graphs = graphs),
  plot()
)

```

As you may have noticed, for each case where we have to provide a list, we can also add the element one by one. In this case with the method "addGraph" as we did firstly.

---

### Add features, custom existing !

Currently you can draw any object derived from: 

* AmCharts API: <http://docs.amcharts.com/3/javascriptcharts>
* AmStockCharts API: <http://docs.amcharts.com/3/javascriptstockchart>

This means you can customize you chart in various ways !

For instance, we can move the default linked label *JS chart by amCharts* (which must be kept if using the library without license). By default, charts come with animation. You can set the speed with the argument `startDuration`:

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country',
             dataProvider = data_gdp, startDuration = 0,
             creditsPosition = "bottom-right"),
  plot()
)
```

#### Scrollbar

```{r}
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0,
                categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5, lineAlpha = 0),
  setChartScrollbar(),
  plot()
)
```

Notice that, some setters have default parameters. Consequently, you can you them as function without parameters.

#### Cursor

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0,
                categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5,
           lineAlpha = 0, color = "blue"),
  addTitle(text = "Main title"),
  addTitle(text = "Sub-title"),
  setChartCursor(),
  setChartScrollbar(),
  plot()
)
```

#### Titles

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0,
                categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5,
           lineAlpha = 0),
  addTitle(text = "Main title"),
  addTitle(text = "Sub-title"),
  setChartCursor(),
  plot()
)
```

### Colors

Set color for all columns:

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amSerialChart(dataProvider = data_gdp, startDuration = 0,
                categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5,
           lineAlpha = 0, fillColors = "#3c8dbc"),
  setChartCursor(),
  plot()
)
```

Set different colors:

```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
colors <- colorRampPalette(c("green", "blue"))(nrow(data_gdp))
data_color <- cbind(data_gdp, colors = colors)

pipeR::pipeline(
  amSerialChart(dataProvider = data_color, startDuration = 0,
                categoryField = 'country'),
  addGraph(valueField = 'gdp', type = 'column', fillAlphas = .5,
           lineAlpha = 0, fillColorsField = "colors"),
  setChartCursor(),
  plot()
)
```

### Themes

For any chart, it is also possible to choose a theme among "light", "dark", "chalk", "patterns". It changes both colors and background (if necessary).
  
```{r, message=FALSE}
library(rAmCharts)
data("data_gdp")
path <- "http://cdn.amcharts.com/lib/3/" # required for independant online html file
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country', startDuration = 0,
             dataProvider = data_gdp, theme = "patterns"),
  plot()
)
```

```{r, echo = FALSE, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country', startDuration = 0,
             dataProvider = data_gdp, theme = "light"),
  plot()
)
```

```{r, echo = FALSE, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country', startDuration = 0,
             dataProvider = data_gdp, theme = "dark"),
  plot()
)
```

```{r, echo = FALSE, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country', startDuration = 0,
             dataProvider = data_gdp, theme = "chalk"),
  plot()
)
```

### Legend

By default a legend set to a pie chart is clickable and the figures are recalculated automatically:
```{r, echo = FALSE, message=FALSE}
library(rAmCharts)
data("data_gdp")
pipeR::pipeline(
  amPieChart(valueField = 'gdp', titleField = 'country', startDuration = 0,
             dataProvider = data_gdp, theme = "patterns"),
  setLegend(useGraphSettings = TRUE, position = "right"),
  plot()
)
```


